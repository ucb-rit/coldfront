# =============================================================================
# ColdFront Containerized Deployment - Environment Variables
# =============================================================================
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# =============================================================================

# -----------------------------------------------------------------------------
# System Configuration
# -----------------------------------------------------------------------------

DJANGO__USE_ENV_SETTINGS=true
DJANGO__DEBUG={{ debug | lower }}
DJANGO__SECRET_KEY={{ django_secret_key }}
DJANGO__ALLOWED_HOSTS={{ hostname }},{{ host_ip }},0.0.0.0
DJANGO__SESSION_COOKIE_SECURE={{ ssl_enabled | default(false) | lower }}

# -----------------------------------------------------------------------------
# Portal/Program Information
# -----------------------------------------------------------------------------

HPCS__PORTAL_NAME={{ portal_name }}
HPCS__PROGRAM_NAME_LONG={{ program_name_long }}
HPCS__PROGRAM_NAME_SHORT={{ program_name_short }}
HPCS__PRIMARY_CLUSTER_NAME={{ primary_cluster_name }}

COLDFRONT__CENTER_BASE_URL={{ full_host_path }}
COLDFRONT__CENTER_USER_GUIDE={{ center_user_guide }}
COLDFRONT__CENTER_LOGIN_GUIDE={{ center_login_guide }}
COLDFRONT__CENTER_HELP_EMAIL={{ center_help_email }}

# -----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# -----------------------------------------------------------------------------

DJANGO__DATABASES_DEFAULT_NAME={{ db_name }}
DJANGO__DATABASES_DEFAULT_USER={{ db_admin_user }}
DJANGO__DATABASES_DEFAULT_PASSWORD={{ db_admin_passwd }}
DJANGO__DATABASES_DEFAULT_HOST={{ db_host }}
DJANGO__DATABASES_DEFAULT_PORT=5432

# -----------------------------------------------------------------------------
# Cache Configuration (Redis)
# -----------------------------------------------------------------------------

HPCS__REDIS_HOST={{ redis_host }}
HPCS__REDIS_PORT=6379
HPCS__REDIS_DB=0
HPCS__REDIS_PASSWORD={{ redis_passwd }}

DJANGO__CACHES_DEFAULT_TIMEOUT=86400

# -----------------------------------------------------------------------------
# Email Configuration
# -----------------------------------------------------------------------------

DJANGO__EMAIL_HOST={{ email_host }}
DJANGO__EMAIL_PORT={{ email_port }}
DJANGO__EMAIL_SUBJECT_PREFIX={{ email_subject_prefix }}

HPCS__EMAIL_FROM={{ from_email }}
HPCS__EMAIL_ADMIN={{ admin_email }}
COLDFRONT__EMAIL_SENDER={{ from_email }}
COLDFRONT__EMAIL_TICKET_SYSTEM_ADDRESS=help@{{ hostname }}
COLDFRONT__EMAIL_DIRECTOR_EMAIL_ADDRESS=director@{{ hostname }}
COLDFRONT__EMAIL_PROJECT_REVIEW_CONTACT=review@{{ hostname }}

{% if email_admin_list is defined and email_admin_list | length > 0 -%}
COLDFRONT__EMAIL_ADMIN_LIST={{ email_admin_list | join(',') }}
{% else -%}
COLDFRONT__EMAIL_ADMIN_LIST=admin@{{ hostname }}
{% endif -%}

COLDFRONT__EMAIL_DEVELOPMENT_EMAIL_LIST=dev1@{{ hostname }},dev2@{{ hostname }}

COLDFRONT__EMAIL_SIGNATURE={{ portal_name }} User Portal team\n{{ full_host_path }}\nEmail: {{ from_email }}

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------

HPCS__LOG_PATH={{ log_path }}/{{ portal_log_file }}
HPCS__API_LOG_PATH={{ log_path }}/{{ api_log_file }}
{% if stream_logs_to_stdout is defined and stream_logs_to_stdout | bool -%}
HPCS__STREAM_LOGS_TO_STDOUT=true
{% else -%}
HPCS__STREAM_LOGS_TO_STDOUT=false
{% endif %}

# -----------------------------------------------------------------------------
# Notification Settings
# -----------------------------------------------------------------------------

{% if request_approval_cc_list is defined and request_approval_cc_list | length > 0 -%}
HPCS__REQUEST_APPROVAL_CC_LIST={{ request_approval_cc_list | join(',') }}
{% else -%}
HPCS__REQUEST_APPROVAL_CC_LIST=
{% endif %}

{% if project_user_removal_request_processed_email_admin_list is defined and project_user_removal_request_processed_email_admin_list | length > 0 -%}
HPCS__PROJECT_USER_REMOVAL_REQUEST_PROCESSED_EMAIL_ADMIN_LIST={{ project_user_removal_request_processed_email_admin_list | join(',') }}
{% else -%}
HPCS__PROJECT_USER_REMOVAL_REQUEST_PROCESSED_EMAIL_ADMIN_LIST=
{% endif %}

# -----------------------------------------------------------------------------
# Security & Access Control
# -----------------------------------------------------------------------------

{% if allow_all_jobs is defined and allow_all_jobs | bool -%}
HPCS__ALLOW_ALL_JOBS=true
{% else -%}
HPCS__ALLOW_ALL_JOBS=false
{% endif %}

# -----------------------------------------------------------------------------
# File Storage Configuration
# -----------------------------------------------------------------------------

{% if django_media_root is defined and django_media_root -%}
DJANGO__MEDIA_ROOT={{ django_media_root }}
{% endif %}

{% if file_storage_backend is defined -%}
HPCS__FILE_STORAGE={{ {'backend': file_storage_backend, 'details': {'NEW_PROJECT_REQUEST_MOU': {'location': new_project_request_mou_path | default(''), 'filename_type': 'NewProject_MOU'}, 'SERVICE_UNITS_PURCHASE_REQUEST_MOU': {'location': service_units_purchase_request_mou_path | default(''), 'filename_type': 'AllowancePurchase_MOU'}, 'SECURE_DIRECTORY_REQUEST_MOU': {'location': secure_directory_request_mou_path | default(''), 'filename_type': 'SecureDirectory_RUA'}}} | to_json }}
{% endif %}

{% if file_storage_backend is defined and file_storage_backend == 'google_drive' -%}
DJANGO_GOOGLEDRIVE_STORAGE__GOOGLE_DRIVE_STORAGE_JSON_KEY_FILE={{ google_drive_private_key_file_path }}
DJANGO_GOOGLEDRIVE_STORAGE__GOOGLE_DRIVE_STORAGE_MEDIA_ROOT={{ google_drive_storage_media_root }}
{% endif %}

# -----------------------------------------------------------------------------
# BRC-Specific Settings
# -----------------------------------------------------------------------------

{% if vector_pi_username is defined -%}
HPCS__VECTOR_PI_USERNAME={{ vector_pi_username }}
{% endif %}

{% if savio_project_for_vector_users is defined -%}
HPCS__SAVIO_PROJECT_FOR_VECTOR_USERS={{ savio_project_for_vector_users }}
{% endif %}

# -----------------------------------------------------------------------------
# Billing Configuration
# -----------------------------------------------------------------------------

{% if (flag_lrc_enabled | default(false) | bool) and (install_billing_validation_package | default(false) | bool) and (oracle_billing_db_dsn | default('') | length > 0) -%}
HPCS__BILLING_VALIDATOR_BACKEND=coldfront.core.billing.utils.validation.backends.oracle.OracleValidatorBackend
HPCS__ORACLE_BILLING_DB_DSN={{ oracle_billing_db_dsn }}
HPCS__ORACLE_BILLING_DB_USER={{ oracle_billing_db_user }}
HPCS__ORACLE_BILLING_DB_PASSWORD={{ oracle_billing_db_passwd }}
{% endif %}

# -----------------------------------------------------------------------------
# Renewal Survey Configuration
# -----------------------------------------------------------------------------

{% if renewal_survey_backend is defined and renewal_survey_backend == 'google_forms' -%}
HPCS__RENEWAL_SURVEY={{ {'backend': 'coldfront.core.project.utils_.renewal_survey.backends.google_forms.GoogleFormsRenewalSurveyBackend', 'details': {'credentials_file_path': renewal_survey_google_forms_service_account_credentials_file_path, 'survey_data_file_path': renewal_survey_google_forms_survey_data_file_path, 'survey_data_cache_key': renewal_survey_google_forms_survey_data_cache_key}} | to_json }}
{% else -%}
HPCS__RENEWAL_SURVEY={{ {'backend': 'coldfront.core.project.utils_.renewal_survey.backends.permissive.PermissiveRenewalSurveyBackend', 'details': {}} | to_json }}
{% endif %}

# -----------------------------------------------------------------------------
# Error Tracking (Sentry)
# -----------------------------------------------------------------------------

{% if sentry_dsn is defined and sentry_dsn | length > 0 -%}
HPCS__SENTRY_DSN={{ sentry_dsn.strip() }}
{% else -%}
HPCS__SENTRY_DSN=
{% endif %}

# -----------------------------------------------------------------------------
# Authentication (CILogon)
# -----------------------------------------------------------------------------

HPCS__CILOGON_APP_CLIENT_ID={{ cilogon_app_client_id }}
HPCS__CILOGON_APP_SECRET={{ cilogon_app_secret }}

# -----------------------------------------------------------------------------
# Feature Flags (django-flags)
# -----------------------------------------------------------------------------

DJANGO_FLAGS__ALLOCATION_RENEWAL_FOR_NEXT_PERIOD_REQUESTABLE_VALUE={{ flag_next_period_renewal_requestable_month }}
DJANGO_FLAGS__BASIC_AUTH_ENABLED_VALUE={{ flag_basic_auth_enabled | lower }}
DJANGO_FLAGS__SSO_ENABLED_VALUE={{ flag_sso_enabled | lower }}
DJANGO_FLAGS__LINK_LOGIN_ENABLED_VALUE={{ flag_link_login_enabled | default(false) | lower }}
DJANGO_FLAGS__BRC_ONLY_VALUE={{ flag_brc_enabled | default(false) | lower }}
DJANGO_FLAGS__LRC_ONLY_VALUE={{ flag_lrc_enabled | default(false) | lower }}
DJANGO_FLAGS__MOU_GENERATION_ENABLED_VALUE={{ flag_mou_generation_enabled | default(false) | lower }}
DJANGO_FLAGS__MULTIPLE_EMAIL_ADDRESSES_ALLOWED_VALUE={{ flag_multiple_email_addresses_allowed | default(false) | lower }}
DJANGO_FLAGS__RENEWAL_SURVEY_ENABLED_VALUE={{ flag_renewal_survey_enabled | default(false) | lower }}
DJANGO_FLAGS__SECURE_DIRS_REQUESTABLE_VALUE={{ flag_brc_enabled | default(false) | lower }}
DJANGO_FLAGS__SERVICE_UNITS_PURCHASABLE_VALUE={{ flag_brc_enabled | default(false) | lower }}

# -----------------------------------------------------------------------------
# Plugins
# -----------------------------------------------------------------------------

{% if plugin_departments_enabled is defined and plugin_departments_enabled | bool -%}
HPCS__PLUGIN_DEPARTMENTS_ENABLED=true
HPCS__PLUGIN_DEPARTMENTS_DEPARTMENT_DISPLAY_NAME={{ plugin_departments_department_display_name }}
HPCS__PLUGIN_DEPARTMENTS_DEPARTMENT_DATA_SOURCE={{ plugin_departments_department_data_source }}
{% else -%}
HPCS__PLUGIN_DEPARTMENTS_ENABLED=false
{% endif %}

# Note: Additional plugin configurations (faculty_storage_allocations, hardware_procurements)
# are not yet supported in env_settings.py. Add them as needed.
