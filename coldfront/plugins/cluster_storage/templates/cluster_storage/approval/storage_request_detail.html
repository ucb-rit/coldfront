{% extends "common/base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% load iso8601_to_datetime %}


{% block title %}
Faculty Storage Allocation Request Detail
{% endblock %}


{% block content %}
<h1>
  Faculty Storage Allocation: {{ storage_request.project.name }}
</h1>
<hr>

{% include 'cluster_storage/approval/storage_request_card.html' with storage_request=storage_request %}

<div class="card mb-3">
  <div class="card-header">
    <h2>
      <i class="fas fa-question-circle" aria-hidden="true"></i>
      Request Status
    </h2>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-sm">
        <tbody>
          <tr>
            <th>Status:</th>
            <td>
              {% include 'cluster_storage/approval/storage_request_status_badge.html' with status=storage_request.status.name %}
            </td>
          </tr>
          <tr>
            <th>Latest Update Timestamp:</th>
            <td>{{ latest_update_timestamp }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

{% if is_allowed_to_manage_request and storage_request.status.name not in 'Approved - Complete,Denied' %}
  <div class="card mb-3">
    <div class="card-header">
      <h2>
        <i class="fas fa-check-circle" aria-hidden="true"></i>
        System Administrator Checklist
      </h2>
    </div>
    <div class="card-body">
      <p>
        This section, which is only visible for system administrators, manages
        this request. Please review the given information and complete the
        checklist in the following order before final approval. You may also
        deny the request for some other reason.
      </p>
      <div class="table-responsive">
        <table class="table table-sm">
          <thead>
            <tr>
              <th scope="col">Task</th>
              <th scope="col">Status</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for item in checklist %}
              <tr>
                <td>{{ item.0 }}</td>
                <td>
                  {% with status=item.1 latest_update_timestamp=item.2 %}
                    {% if status == 'Approved - Processing' or status == 'Pending' or status == 'Under Review' %}
                      <span class="badge badge-warning">
                    {% elif status == 'Approved' or status == 'Approved - Complete' %}
                      <span class="badge badge-success">
                    {% else %}
                      <span class="badge badge-danger">
                    {% endif %}
                      {{ status }}
                      {% if latest_update_timestamp %}
                        {{ latest_update_timestamp|iso8601_to_datetime }}
                      {% endif %}
                      </span>
                  {% endwith %}
                </td>
                <td>
                  {% if item.3 %}
                    <a href="{{ item.4 }}" class="btn btn-primary">
                      Manage
                    </a>
                  {% else %}
                    <button class="btn btn-primary" disabled="true">
                      Manage
                    </button>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <hr>
      {% if is_checklist_complete %}
        <form action="#" method="post">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">Submit</button>
          <a href="#" class="btn btn-secondary">Cancel</a>
          <a href="#" class="btn btn-danger" style="float: right;">
            Deny For Other Reason
          </a>
        </form>
      {% else %}
        <button type="button" class="btn btn-primary" disabled>Submit</button>
        <a href="#" class="btn btn-secondary">Cancel</a>
        <a href="#" class="btn btn-danger" style="float: right;">
          Deny For Other Reason
        </a>
      {% endif %}
    </div>
  </div>
{% endif %}

{% endblock %}